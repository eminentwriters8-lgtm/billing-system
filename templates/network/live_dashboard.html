<!DOCTYPE html>
<html>
<head>
    <title>Network Bandwidth Monitor - Africa Online Networks</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #1a1a1a; color: white; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; text-align: center; border-radius: 10px; margin-bottom: 20px; }
        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .metric-card { background: #2d2d2d; padding: 25px; border-radius: 10px; text-align: center; border-left: 4px solid #667eea; }
        .metric-value { font-size: 2.5em; font-weight: bold; margin: 10px 0; }
        .metric-label { color: #aaa; font-size: 0.9em; }
        .speed-meter { background: #2d2d2d; padding: 25px; border-radius: 10px; margin-bottom: 20px; }
        .meter-bar { background: #333; height: 30px; border-radius: 15px; margin: 15px 0; overflow: hidden; }
        .download-bar { background: linear-gradient(90deg, #00c6ff, #0072ff); height: 100%; width: 0%; transition: width 0.5s; }
        .upload-bar { background: linear-gradient(90deg, #f46b45, #eea849); height: 100%; width: 0%; transition: width 0.5s; margin-top: 10px; }
        .chart-container { background: #2d2d2d; padding: 25px; border-radius: 10px; margin-bottom: 20px; }
        .back-btn { background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-bottom: 20px; }
        .back-btn:hover { background: #764ba2; }
        .data-usage { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .usage-card { background: #2d2d2d; padding: 15px; border-radius: 8px; text-align: center; }
        .usage-value { font-size: 1.5em; font-weight: bold; }
        .usage-label { color: #aaa; font-size: 0.8em; }
    </style>
</head>
<body>
    <button class="back-btn" onclick="location.href='/clients/'">← Back to Dashboard</button>
    
    <div class="header">
        <h1>🌐 Network Bandwidth Monitor</h1>
        <p>Real-Time Upload/Download Speed & Data Usage Tracking</p>
    </div>

    <div class="metrics-grid">
        <div class="metric-card">
            <div class="metric-label">Download Speed</div>
            <div class="metric-value" id="download-speed">0 Mbps</div>
            <div class="meter-bar">
                <div class="download-bar" id="download-bar"></div>
            </div>
        </div>
        
        <div class="metric-card">
            <div class="metric-label">Upload Speed</div>
            <div class="metric-value" id="upload-speed">0 Mbps</div>
            <div class="meter-bar">
                <div class="upload-bar" id="upload-bar"></div>
            </div>
        </div>
        
        <div class="metric-card">
            <div class="metric-label">Active Sessions</div>
            <div class="metric-value" id="active-sessions">0</div>
            <div class="metric-label">Connected Devices</div>
        </div>
        
        <div class="metric-card">
            <div class="metric-label">Network Health</div>
            <div class="metric-value" id="network-health">100%</div>
            <div class="metric-label">Uptime Status</div>
        </div>
    </div>

    <div class="data-usage">
        <div class="usage-card">
            <div class="usage-value" id="data-today">0 GB</div>
            <div class="usage-label">Data Used Today</div>
        </div>
        <div class="usage-card">
            <div class="usage-value" id="data-month">0 GB</div>
            <div class="usage-label">Data This Month</div>
        </div>
        <div class="usage-card">
            <div class="usage-value" id="peak-usage">0 Mbps</div>
            <div class="usage-label">Peak Usage Today</div>
        </div>
        <div class="usage-card">
            <div class="usage-value" id="avg-usage">0 Mbps</div>
            <div class="usage-label">Average Usage</div>
        </div>
    </div>

    <div class="chart-container">
        <h3>Bandwidth Usage - Last 60 Minutes</h3>
        <canvas id="bandwidthChart" width="400" height="200" style="background: #1a1a1a;"></canvas>
    </div>

    <script>
        let bandwidthHistory = [];
        
        // Fetch real network data from API
        function fetchNetworkData() {
            fetch('/clients/network/api/traffic/')
                .then(response => response.json())
                .then(data => {
                    updateDisplay(data);
                    updateBandwidthChart(data);
                })
                .catch(error => {
                    console.log('Failed to fetch network data');
                    // Fallback to simulated data
                    const simulatedData = {
                        download: (Math.random() * 100).toFixed(1),
                        upload: (Math.random() * 30).toFixed(1),
                        sessions: Math.floor(Math.random() * 50) + 10,
                        health: 95 + Math.random() * 5
                    };
                    updateDisplay(simulatedData);
                    updateBandwidthChart(simulatedData);
                });
        }
        
        function updateDisplay(data) {
            // Update speed displays
            document.getElementById('download-speed').textContent = data.download + ' Mbps';
            document.getElementById('upload-speed').textContent = data.upload + ' Mbps';
            document.getElementById('active-sessions').textContent = data.sessions;
            document.getElementById('network-health').textContent = data.health.toFixed(0) + '%';
            
            // Update meter bars (scale to percentage)
            document.getElementById('download-bar').style.width = Math.min(data.download, 100) + '%';
            document.getElementById('upload-bar').style.width = Math.min(data.upload, 100) + '%';
            
            // Update data usage (simulated for now)
            document.getElementById('data-today').textContent = (data.download * 0.1).toFixed(1) + ' GB';
            document.getElementById('data-month').textContent = (data.download * 2).toFixed(1) + ' GB';
            document.getElementById('peak-usage').textContent = Math.max(data.download, 85).toFixed(1) + ' Mbps';
            document.getElementById('avg-usage').textContent = (data.download * 0.7).toFixed(1) + ' Mbps';
        }
        
        function updateBandwidthChart(data) {
            // Add current data to history
            bandwidthHistory.push({
                time: new Date().toLocaleTimeString(),
                download: parseFloat(data.download),
                upload: parseFloat(data.upload)
            });
            
            // Keep only last 60 entries
            if (bandwidthHistory.length > 60) {
                bandwidthHistory.shift();
            }
            
            // Simple chart implementation
            const canvas = document.getElementById('bandwidthChart');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // Clear canvas
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            // Draw grid
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = height - (i * height / 5);
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }
            
            // Draw download line
            if (bandwidthHistory.length > 1) {
                ctx.strokeStyle = '#0072ff';
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                bandwidthHistory.forEach((point, index) => {
                    const x = (index / (bandwidthHistory.length - 1)) * width;
                    const y = height - (point.download / 100 * height);
                    
                    if (index === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });
                ctx.stroke();
                
                // Draw upload line
                ctx.strokeStyle = '#eea849';
                ctx.beginPath();
                
                bandwidthHistory.forEach((point, index) => {
                    const x = (index / (bandwidthHistory.length - 1)) * width;
                    const y = height - (point.upload / 100 * height);
                    
                    if (index === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });
                ctx.stroke();
            }
        }
        
        // Update every 2 seconds
        setInterval(fetchNetworkData, 2000);
        fetchNetworkData(); // Initial call
    </script>
</body>
</html>
