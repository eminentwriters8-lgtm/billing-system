{% extends "base.html" %}

{% block title %}Billing & Payments - Africa Online Networks{% endblock %}

{% block mobile_content %}
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-value">KSH {{ monthly_revenue|default:"0" }}</div>
        <div class="stat-label">Monthly Revenue</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ pending_payments|default:"0" }}</div>
        <div class="stat-label">Pending Payments</div>
    </div>
</div>

<div class="card">
    <h3>Quick Actions</h3>
    <div style="display: grid; grid-template-columns: 1fr; gap: 10px;">
        <a href="/admin/clients/invoice/add/" class="btn btn-primary">
            <i class="fas fa-file-invoice"></i> Create Invoice
        </a>
        <a href="/admin/clients/payment/add/" class="btn btn-primary">
            <i class="fas fa-money-bill-wave"></i> Record Payment
        </a>
    </div>
</div>

<div class="card">
    <h3>Recent Payments</h3>
    {% if recent_payments %}
        {% for payment in recent_payments %}
        <div style="padding: 10px; border-bottom: 1px solid #eee;">
            <strong>{{ payment.client.name }}</strong><br>
            <small>KSH {{ payment.amount }} • {{ payment.payment_date|date:"M d, Y" }}</small>
        </div>
        {% endfor %}
    {% else %}
        <p style="text-align: center; color: #666; padding: 20px;">
            No payments recorded yet
        </p>
    {% endif %}
</div>
{% endblock %}

{% block desktop_content %}
<div class="header">
    <h1>💰 Billing & Payments</h1>
    <p>Financial Management System</p>
</div>

<div class="stats-grid">
    <div class="stat-card pulse">
        <div class="stat-value">KSH {{ monthly_revenue|default:"0" }}</div>
        <div class="stat-label">Monthly Revenue</div>
        <div class="stat-trend">Current Month</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">KSH {{ yearly_revenue|default:"0" }}</div>
        <div class="stat-label">Yearly Revenue</div>
        <div class="stat-trend">Year to Date</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">KSH {{ pending_payments|default:"0" }}</div>
        <div class="stat-label">Pending Payments</div>
        <div class="stat-trend">Requires Attention</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ recent_payments|length|default:"0" }}</div>
        <div class="stat-label">Recent Transactions</div>
        <div class="stat-trend">Last 10 Payments</div>
    </div>
</div>

<div class="card">
    <h3>📋 Payment Distribution</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
        {% for method in payment_methods %}
        <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 10px;">
            <div style="font-size: 1.2em; font-weight: bold; color: #667eea;">
                KSH {{ method.total|default:"0" }}
            </div>
            <div style="color: #666; text-transform: capitalize;">{{ method.payment_method }}</div>
            <div style="font-size: 0.8em; color: #999;">{{ method.count }} payments</div>
        </div>
        {% empty %}
        <div style="text-align: center; padding: 20px; color: #666;">
            <i class="fas fa-chart-pie fa-2x"></i>
            <p>No payment data available</p>
        </div>
        {% endfor %}
    </div>
</div>

<div class="card">
    <h3>✅ Recent Payments</h3>
    {% if recent_payments %}
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background: #f8f9fa;">
                <th style="padding: 12px; text-align: left;">Client</th>
                <th style="padding: 12px; text-align: left;">Amount</th>
                <th style="padding: 12px; text-align: left;">Method</th>
                <th style="padding: 12px; text-align: left;">Date</th>
            </tr>
        </thead>
        <tbody>
            {% for payment in recent_payments %}
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 12px;">{{ payment.client.name }}</td>
                <td style="padding: 12px; font-weight: bold;">KSH {{ payment.amount }}</td>
                <td style="padding: 12px; text-transform: capitalize;">{{ payment.payment_method }}</td>
                <td style="padding: 12px;">{{ payment.payment_date|date:"M d, Y" }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div style="text-align: center; padding: 40px; color: #666;">
        <i class="fas fa-receipt fa-3x"></i>
        <p>No payments recorded yet</p>
        <a href="/admin/clients/payment/add/" class="btn btn-primary" style="margin-top: 10px;">
            <i class="fas fa-plus"></i> Record First Payment
        </a>
    </div>
    {% endif %}
</div>

<div class="card">
    <h3>🚀 Quick Actions</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
        <a href="/admin/clients/invoice/add/" class="btn btn-primary">
            <i class="fas fa-file-invoice"></i> Create Invoice
        </a>
        <a href="/admin/clients/payment/add/" class="btn btn-primary">
            <i class="fas fa-money-bill-wave"></i> Record Payment
        </a>
        <a href="/admin/clients/client/" class="btn">
            <i class="fas fa-users"></i> Manage Clients
        </a>
        <a href="/admin/clients/invoice/" class="btn">
            <i class="fas fa-list"></i> View Invoices
        </a>
    </div>
</div>
{% endblock %}
