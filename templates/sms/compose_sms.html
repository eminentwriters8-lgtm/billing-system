{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h2 class="mb-0">📱 Send SMS from 0706315742</h2>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <strong>Sender:</strong> 0706315742 (Africa Online Networks)<br>
                    <strong>Current Mode:</strong> Mock Testing (No real SMS sent)
                </div>
                
                <form method="post">
                    {% csrf_token %}
                    
                    <div class="mb-3">
                        <label class="form-label">Select Clients</label>
                        <div style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px;">
                            {% for client in clients %}
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="clients" value="{{ client.id }}" id="client{{ client.id }}">
                                <label class="form-check-label" for="client{{ client.id }}">
                                    {{ client.full_name }} ({{ client.phone }}) - KSH {{ client.monthly_rate }}
                                </label>
                            </div>
                            {% empty %}
                            <p class="text-muted">No active clients found</p>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Message</label>
                        <textarea name="message" class="form-control" rows="5" placeholder="Type your message here..." required 
                                  oninput="calculateCost()"></textarea>
                        <small class="text-muted">
                            Characters: <span id="charCount">0</span> | 
                            Segments: <span id="segmentCount">0</span> | 
                            Estimated Cost: KSH <span id="costEstimate">0.00</span>
                        </small>
                    </div>
                    
                    <div class="d-flex gap-2">
                        <a href="{% url 'client_list' %}" class="btn btn-secondary">Cancel</a>
                        <button type="submit" class="btn btn-success">Send SMS</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Quick Templates -->
        <div class="card mt-3">
            <div class="card-header">
                <h5 class="mb-0">💡 Quick Templates</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 mb-2">
                        <button type="button" class="btn btn-outline-primary btn-sm w-100" onclick="setTemplate('payment')">
                            💰 Payment Reminder
                        </button>
                    </div>
                    <div class="col-md-4 mb-2">
                        <button type="button" class="btn btn-outline-success btn-sm w-100" onclick="setTemplate('welcome')">
                            👋 Welcome Message
                        </button>
                    </div>
                    <div class="col-md-4 mb-2">
                        <button type="button" class="btn btn-outline-warning btn-sm w-100" onclick="setTemplate('outage')">
                            ⚠️ Service Notice
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function calculateCost() {
        const message = document.querySelector('textarea[name="message"]').value;
        const charCount = message.length;
        const segments = Math.ceil(charCount / 160);
        const cost = segments * 0.80; // KES 0.80 per segment
        
        document.getElementById('charCount').textContent = charCount;
        document.getElementById('segmentCount').textContent = segments;
        document.getElementById('costEstimate').textContent = cost.toFixed(2);
    }
    
    // Quick templates
    function setTemplate(type) {
        const templates = {
            'payment': 'Hello [Name], your internet payment of KSH [Amount] is due on [Date]. Pay via M-Pesa to 0706315742. Thank you - Africa Online Networks',
            'welcome': 'Welcome to Africa Online Networks! Your internet service is now active. For support call 0706315742. Enjoy browsing!',
            'outage': 'Important: Scheduled maintenance on [Date] from [Time]. Service may be interrupted briefly. We apologize for any inconvenience.'
        };
        document.querySelector('textarea[name="message"]').value = templates[type];
        calculateCost();
    }
    
    // Initialize cost calculation
    calculateCost();
</script>
{% endblock %}
