{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block content %}
<div class="container mt-4">
    <h2>ğŸ“± Bulk WhatsApp Messages</h2>
    
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h5>Compose WhatsApp Message</h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        
                        <div class="mb-3">
                            <label class="form-label">Select Clients:</label>
                            <div style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px;">
                                {% for client in clients %}
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="clients" value="{{ client.id }}" id="client{{ client.id }}">
                                    <label class="form-check-label" for="client{{ client.id }}">
                                        {{ client.full_name }} - {{ client.phone }} ({{ client.service_plan.name }})
                                    </label>
                                </div>
                                {% endfor %}
                            </div>
                            <small class="text-muted">Select multiple clients to send bulk messages</small>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Message Template:</label>
                            <textarea class="form-control" name="message" rows="8" placeholder="Type your WhatsApp message here..."></textarea>
                            <small class="text-muted">
                                Available variables: {name}, {username}, {plan}
                            </small>
                        </div>
                        
                        <div class="mb-3">
                            <h6>Quick Templates:</h6>
                            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="loadTemplate('payment')">Payment Reminder</button>
                            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="loadTemplate('welcome')">Welcome Message</button>
                            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="loadTemplate('outage')">Service Outage</button>
                        </div>
                        
                        <button type="submit" class="btn btn-success">
                            ğŸ“¤ Send WhatsApp Messages
                        </button>
                        <a href="{% url 'whatsapp_reminders' %}" class="btn btn-primary">
                            ğŸ’° Send Payment Reminders
                        </a>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function loadTemplate(type) {
    const templates = {
        'payment': `Hello {name}! ğŸ‘‹\n\nThis is a friendly reminder that your payment for {plan} is due soon.\n\nUsername: {username}\n\nPlease make payment to avoid service interruption.\n\nThank you! ğŸ’™`,
        'welcome': `Welcome {name}! ğŸ‰\n\nYour internet service has been activated!\n\nUsername: {username}\nPlan: {plan}\n\nIf you need any assistance, please contact us.\n\nEnjoy your service! ğŸš€`,
        'outage': `Hello {name}! âš ï¸\n\nWe want to inform you about scheduled maintenance that may affect your service temporarily.\n\nWe apologize for any inconvenience and will restore service as quickly as possible.\n\nThank you for your understanding! ğŸ™`
    };
    
    document.querySelector('textarea[name="message"]').value = templates[type];
}
</script>
{% endblock %}